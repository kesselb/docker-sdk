version: "3.7"

services:
{% for serviceName, serviceData in services %}
{% set engine = serviceData['engine'] | lower %}
{% set version = serviceData['version'] | default('default') %}
{% set isSharedService = serviceData['shared'] | default(false) %}
{% include "service/" ~ engine ~ "/" ~ version ~ "/" ~  engine ~ ".yml.twig" with { project: _context, serviceName: serviceName, serviceData: serviceData, engine: engine, version: version } only %}
{% endfor %}

volumes:
{% for service, serviceData in services %}
  {{ service }}-{{ serviceData['engine'] }}-data:
      external: false
{% endfor %}
{% if  _mountMode != 'baked' and _mountMode != 'native' %}
  {{ namespace }}_{{ tag }}_data_sync:
      external: true
{% endif %}
  ssh-relay:
      external: false
  logs:
      external: false

networks:
    public:
    private:
